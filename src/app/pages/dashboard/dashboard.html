<!-- Static sidebar for desktop -->
<div
  class="hidden lg:fixed xl:fixed xl:inset-y-0 xl:z-50 xl:flex xl:w-72 xl:flex-col dark:bg-gray-950"
>
  <div
    class="flex grow flex-col gap-y-5 overflow-y-auto bg-gray-50 px-6 ring-1 ring-gray-200 dark:bg-black/10 dark:ring-white/5"
  >
    <div class="flex h-16 shrink-0 items-center">
      <img
        src="/../logo.png"
        alt="Your Company"
        class="h-14 w-auto dark:hidden"
      />
      <img
        src="/../logo.png"
        alt="Your Company"
        class="h-14 w-auto not-dark:hidden"
      />
    </div>
    <nav class="flex flex-1 flex-col">
      <ul role="list" class="flex flex-1 flex-col gap-y-7">
        <li>
          <ul role="list" class="-mx-2 space-y-1">
            <li>
              <div class="relative">
                <button
                  id="user-menu-button"
                  type="button"
                  aria-haspopup="true"
                  (click)="toggleMenu()"
                  [attr.aria-expanded]="isOpen"
                  class="group flex gap-x-3 rounded-md p-2 text-sm/6 font-semibold text-gray-700 hover:bg-gray-100 hover:text-indigo-600 dark:text-gray-50 dark:hover:bg-white/5 dark:hover:text-white"
                >
                  <span class="absolute -inset-1.5 lg:hidden"></span>
                  <span
                    class="ml-3 hidden text-sm font-medium text-gray-50 lg:block"
                    ><span class="sr-only">Open user menu for </span>Bienvenido
                    {{ currentUserName }}</span
                  >
                  <svg
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    data-slot="icon"
                    aria-hidden="true"
                    class="ml-1 hidden size-5 shrink-0 text-gray-400 lg:block"
                  >
                    <path
                      d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                      clip-rule="evenodd"
                      fill-rule="evenodd"
                    />
                  </svg>
                </button>

                <div
                  *ngIf="isOpen"
                  role="menu"
                  tabindex="-1"
                  aria-labelledby="user-menu-button"
                  aria-orientation="vertical"
                  class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-gray-950 py-1 shadow-lg ring-1 ring-white/10 focus:outline-none"
                >
                  <a
                    id="user-menu-item-1"
                    role="menuitem"
                    (click)="openChangePasswordModal()"
                    tabindex="-1"
                    class="block px-4 py-2 text-sm text-gray-50 hover:bg-gray-900"
                    >Cambiar contraseña</a
                  >
                  <a
                    id="user-menu-item-2"
                    role="menuitem"
                    (click)="logout()"
                    tabindex="-1"
                    class="block px-4 py-2 text-sm text-gray-50 hover:bg-gray-900"
                    >Cerrar sesión</a
                  >
                </div>
              </div>
            </li>

            <ng-container *ngFor="let item of navigation">
              <li *ngIf="item.separator">
                <div
                  class="text-xs/6 font-semibold text-gray-500 mt-4 dark:text-gray-200 px-2"
                >
                  {{ item.separator }}
                </div>
              </li>

              <li *ngIf="!item.separator">
                <a
                  [routerLink]="[routeBase, item.routerLink]"
                  routerLinkActive="bg-gray-100 dark:bg-white/5 text-indigo-600 dark:text-white"
                  [routerLinkActiveOptions]="{ exact: true }"
                  class="group flex gap-x-3 rounded-md p-2 text-sm/6 font-semibold text-gray-700 hover:bg-gray-100 hover:text-indigo-600 dark:text-gray-50 dark:hover:bg-white/5 dark:hover:text-white"
                >
                  <lucide-icon
                    [name]="item.iconName"
                    class="h-6 w-6 shrink-0"
                  ></lucide-icon>
                  {{ item.name }}
                </a>
              </li>
            </ng-container>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</div>
<!-- End sidebar -->
<!-- Sidebar mobile -->
<div class="xl:pl-72">
  <div
    class="xl:hidden sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-6 border-b border-gray-200 bg-white px-4 shadow-xs sm:px-6 lg:px-8 dark:border-white/5 dark:bg-gray-950 dark:shadow-none"
  >
    <button
      type="button"
      (click)="toggleSidebar()"
      class="-m-2.5 p-2.5 text-gray-900 xl:hidden dark:text-white"
    >
      <span class="sr-only">Open sidebar</span>
      <lucide-icon name="menu"></lucide-icon>
    </button>
  </div>

  <div *ngIf="isSidebarOpen">
    <div class="fixed inset-0 z-50 flex focus:outline-none">
      <div
        (click)="toggleSidebar()"
        class="xl:hidden fixed inset-0 bg-black/50 transition-opacity duration-300 ease-linear"
        [ngClass]="{
          'opacity-100': isSidebarOpen,
          'opacity-0': !isSidebarOpen
        }"
      ></div>

      <div
        class="relative mr-16 flex w-full max-w-xs flex-1 transform transition duration-300 ease-in-out"
        [ngClass]="{
          'translate-x-0': isSidebarOpen,
          '-translate-x-full': !isSidebarOpen
        }"
      >
        <div
          class="absolute top-0 left-full flex w-16 justify-center pt-5 duration-300 ease-in-out"
          [ngClass]="{
            'opacity-100': isSidebarOpen,
            'opacity-0': !isSidebarOpen
          }"
        >
          <button type="button" (click)="toggleSidebar()" class="lg:hidden">
            <span class="sr-only">Close sidebar</span>
            <lucide-icon name="x" class="size-6 text-white"></lucide-icon>
          </button>
        </div>
        <div
          class="relative flex grow flex-col gap-y-5 overflow-y-auto dark:bg-gray-950 px-6 dark:before:pointer-events-none dark:before:absolute dark:before:inset-0"
        >
          <div class="relative flex h-16 shrink-0 items-center">
            <img
              src="/../logo.png"
              alt="Your Company"
              class="h-14 w-auto dark:hidden"
            />
            <img
              src="/../logo.png"
              alt="Your Company"
              class="h-14 w-auto not-dark:hidden"
            />
          </div>
          <nav class="relative flex flex-1 flex-col">
            <ul role="list" class="flex flex-1 flex-col gap-y-7">
              <li>
                <ul role="list" class="-mx-2 space-y-1">
                  <li>
                    <div class="relative">
                      <button
                        id="user-menu-button"
                        type="button"
                        aria-haspopup="true"
                        (click)="toggleMenu()"
                        [attr.aria-expanded]="isOpen"
                        class="group flex gap-x-3 rounded-md p-2 text-sm/6 font-semibold text-gray-700 hover:bg-gray-100 hover:text-indigo-600 dark:text-gray-50 dark:hover:bg-white/5 dark:hover:text-white"
                      >
                        <span class="absolute -inset-1.5 lg:hidden"></span>

                        <span
                          class="ml-3 text-sm font-medium text-gray-50 lg:block"
                          ><span class="sr-only">Open user menu for </span
                          >Bienvenido {{ currentUserName }}</span
                        >

                        <svg
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          data-slot="icon"
                          aria-hidden="true"
                          class="ml-1 size-5 shrink-0 text-gray-400"
                        >
                          <path
                            d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                            clip-rule="evenodd"
                            fill-rule="evenodd"
                          />
                        </svg>
                      </button>

                      <div
                        *ngIf="isOpen"
                        role="menu"
                        tabindex="-1"
                        aria-labelledby="user-menu-button"
                        aria-orientation="vertical"
                        class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-gray-950 py-1 shadow-lg ring-1 ring-white/10 focus:outline-none"
                      >
                        <a
                          id="user-menu-item-1"
                          role="menuitem"
                          (click)="openChangePasswordModal()"
                          tabindex="-1"
                          class="block px-4 py-2 text-sm text-gray-50 hover:bg-gray-900"
                          >Cambiar contraseña</a
                        >
                        <a
                          id="user-menu-item-2"
                          role="menuitem"
                          (click)="logout()"
                          tabindex="-1"
                          class="block px-4 py-2 text-sm text-gray-50 hover:bg-gray-900"
                          >Cerrar sesión</a
                        >
                      </div>
                    </div>
                  </li>

                  <ng-container *ngFor="let item of navigation">
                    <li *ngIf="item.separator">
                      <div
                        class="text-xs/6 font-semibold text-gray-500 mt-4 dark:text-gray-200 px-2"
                      >
                        {{ item.separator }}
                      </div>
                    </li>

                    <li *ngIf="!item.separator">
                      <a
                        [routerLink]="[routeBase, item.routerLink]"
                        routerLinkActive="bg-gray-100 dark:bg-white/5 text-indigo-600 dark:text-white"
                        [routerLinkActiveOptions]="{ exact: true }"
                        class="group flex gap-x-3 rounded-md p-2 text-sm/6 font-semibold text-gray-700 hover:bg-gray-100 hover:text-indigo-600 dark:text-gray-50 dark:hover:bg-white/5 dark:hover:text-white"
                        (click)="toggleSidebar()"
                      >
                        <lucide-icon
                          [name]="item.iconName"
                          class="h-6 w-6 shrink-0"
                        ></lucide-icon>
                        {{ item.name }}
                      </a>
                    </li>
                  </ng-container>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- End Sidebar mobile -->
  <main class="">
    <!-- End contenido principal -->
    <!-- Cargar los demás componentes Productos, etc -->
    <router-outlet></router-outlet>
  </main>
</div>

<!-- <div
  aria-live="assertive"
  class="pointer-events-none fixed inset-0 flex items-start justify-end px-4 py-6 sm:p-6 z-50"
  *ngIf="productosConstockBajo.length > 0"
>
  <div class="flex w-full flex-col items-center space-y-4 sm:items-end">
    <div
      *ngFor="let producto of productosConstockBajo; let i = index"
      class="pointer-events-auto flex w-full max-w-md translate-y-0 transform divide-x divide-gray-200 rounded-lg bg-white opacity-100 shadow-lg outline outline-1 outline-black/5 transition duration-300 ease-out sm:translate-x-0 dark:divide-white/10 dark:bg-gray-800 dark:-outline-offset-1 dark:outline-white/10"
    >
      <div class="flex w-0 flex-1 items-start p-4">
        <div class="flex-shrink-0 pt-0.5">
          <lucide-icon
            name="alert-triangle"
            class="h-6 w-6 text-red-500"
          ></lucide-icon>
        </div>

        <div class="ml-3 w-0 flex-1">
          <p class="text-sm font-medium text-gray-900 dark:text-white">
            🚨 Alerta de Stock Bajo: **{{ producto.nombre }}**
          </p>

          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            {{ getLowstockMessage(producto) }}
          </p>

          <p
            *ngIf="producto.descripcion"
            class="mt-1 text-xs italic text-gray-400 dark:text-gray-500"
          >
            SKU: {{ producto.sku }} - Desc.:
            {{ producto.descripcion.substring(0, 50)
            }}{{ producto.descripcion.length > 50 ? "..." : "" }}
          </p>
        </div>
      </div>

      <div class="flex">
        <button
          type="button"
          (click)="removeLowstockProduct(producto.productoId)"
          class="flex h-full w-full items-center justify-center rounded-r-lg p-3 text-sm font-medium text-gray-400 hover:text-gray-700 focus:outline focus:outline-2 focus:outline-indigo-500 dark:hover:text-white dark:focus:outline-indigo-400"
        >
          <lucide-icon name="x" class="h-5 w-5"></lucide-icon>
        </button>
      </div>
    </div>
  </div>
</div> -->
<!-- 🔔 Notificaciones de stock bajo -->
<div
  aria-live="assertive"
  class="pointer-events-none fixed inset-0 flex items-end px-4 py-6 sm:items-start sm:p-6"
>
  <div class="flex w-full flex-col items-center space-y-4 sm:items-end">
    <!-- Recorremos todas las notificaciones -->
    <div
      *ngFor="let notif of notificaciones"
      class="pointer-events-auto flex w-full max-w-md translate-y-0 transform divide-x divide-gray-200 rounded-lg bg-white opacity-100 shadow-lg outline outline-1 outline-black/5 transition duration-300 ease-out sm:translate-x-0 dark:divide-white/10 dark:bg-gray-800 dark:-outline-offset-1 dark:outline-white/10 [@starting-style]:translate-y-2 [@starting-style]:opacity-0 [@starting-style]:sm:translate-x-2 [@starting-style]:sm:translate-y-0"
    >
      <div class="flex w-0 flex-1 items-center p-4">
        <div class="w-full">
          <p class="text-sm font-medium text-gray-900 dark:text-white">
            {{ notif.titulo }}
          </p>
          <p
            class="mt-1 text-sm text-gray-500 dark:text-gray-400"
            [innerHTML]="notif.mensaje"
          ></p>
        </div>
      </div>

      <!-- Botón de cerrar -->
      <div class="flex">
        <button
          type="button"
          (click)="cerrarNotificacion(notif.id)"
          class="flex w-full items-center justify-center rounded-r-lg px-4 py-3 text-sm font-medium text-red-600 hover:text-red-500 focus:z-10 focus:outline focus:outline-2 focus:outline-red-500 dark:text-red-400 dark:hover:text-red-300 dark:focus:outline-red-400"
        >
          ✖
        </button>
      </div>
    </div>
  </div>
</div>

<dialog
  id="change-pass-modal"
  class="relative z-10"
  [open]="isChangePasswordModalOpen"
  (close)="closeChangePasswordModal()"
>
  <!-- backdrop -->
  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

  <!-- modal container -->
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div
      class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"
    >
      <div
        class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"
      >
        <!-- Cerrar (X) -->
        <div class="absolute right-0 top-0 hidden pr-4 pt-4 sm:block">
          <button
            (click)="closeChangePasswordModal()"
            type="button"
            class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
          >
            <span class="sr-only">Close</span>
            <lucide-icon name="x" class="h-6 w-6"></lucide-icon>
          </button>
        </div>

        <!-- Título -->
        <h3 class="text-base font-semibold leading-6 text-gray-900 mb-4">
          Cambiar contraseña
        </h3>

        <!-- Errores de validación -->
        <div *ngIf="validationErrors.length" class="mb-4">
          <div class="rounded-md bg-red-50 p-4">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg
                  class="h-5 w-5 text-red-400"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                  aria-hidden="true"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94l-1.72-1.72z"
                    clip-rule="evenodd"
                  />
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-red-800">
                  Se encontraron los siguientes errores:
                </h3>
                <ul class="mt-2 text-sm text-red-700 list-disc pl-5 space-y-1">
                  <li *ngFor="let err of validationErrors">{{ err }}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Formulario -->
        <form (ngSubmit)="submitChangePassword()" class="space-y-4">
          <div>
            <label
              for="actual-pass"
              class="block text-sm font-medium text-gray-900"
              >Contraseña actual</label
            >
            <input
              type="password"
              id="actual-pass"
              name="actualPass"
              [(ngModel)]="actualPassword"
              required
              class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 sm:text-sm"
            />
          </div>

          <div>
            <label
              for="new-pass"
              class="block text-sm font-medium text-gray-900"
              >Nueva contraseña</label
            >
            <input
              type="password"
              id="new-pass"
              name="newPass"
              [(ngModel)]="newPassword"
              required
              minlength="6"
              class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 sm:text-sm"
            />
          </div>

          <div class="flex justify-end gap-x-3 mt-6">
            <button
              type="button"
              (click)="closeChangePasswordModal()"
              class="inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
            >
              Cancelar
            </button>

            <button
              type="submit"
              class="inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
            >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</dialog>
